<!DOCTYPE html>
<html>

<head>
  <style>
    body {
      font-family: sans-serif;
    }

    h3,
    h5 {
      margin: 0 0 5px 0;
    }

    p {
      margin: 10px 0;
    }

    p.small {
      margin: 5px 0;
      font-size: 0.8rem;
      color: #666
    }

    textarea {
      width: 100%;
      max-width: 100%;
      min-width: 100%;
      height: 100px;
      margin-bottom: 10px;
    }

    select,
    .inputs {
      margin-bottom: 10px;
      display: flex;
    }

    .col-2 {
      justify-content: space-between;
      margin-bottom: 10px;
      gap: 10px;
    }

    .input-checkbox {
      display: flex;
      align-items: left;
      width: 50%;
    }

    input[type="number"] {
      width: 100%;
    }

    button {
      padding: 5px 10px;
    }
  </style>
</head>

<body>
  <select id="action">
    <option value="set-w-h">Set width and/or height</option>
    <option value="set-scale">Scale</option>
    <option value="set-x-y">Set x and/or y position</option>
    <option value="set-color">Set color</option>
    <option value="set-opacity">Set opacity</option>
    <option value="set-x-y-vector">Set x and/or y of Vector</option>
  </select>

  <h3 class="action-ui action-set-w-h">Set width and/or height</h3>
  <h3 class="action-ui action-set-scale" style="display: none;">Scale</h3>
  <h3 class="action-ui action-set-x-y" style="display: none;">Set x and/or y position</h3>
  <h3 class="action-ui action-set-x-y-vector" style="display: none;">Set x and/or y of Vector</h3>
  <h3 class="action-ui action-set-color" style="display: none;">Set fill or stroke color</h3>
  <h3 class="action-ui action-set-opacity" style="display: none;">Set opacity</h3>
  <p>Enter one numeric value per line (or comma-separated):</p>
  <p class="small">If no values are provided, random values will be generated.</p>
  <textarea id="csv-input" placeholder="e.g. 100, 200, 150"></textarea>
  <div id="input-range" style="display: none;">
    <h5>Input Range</h5>
    <div class="inputs col-2">
      <label for="inputMin">Min:</label>
      <input id="inputMin" placeholder="auto" type="number" value="0" />
      <label for="inputMax">Max:</label>
      <input id="inputMax" placeholder="auto" type="number" />
    </div>
  </div>
  <div id="target-range">
    <h5>Target Range (px)</h5>
    <div class="inputs col-2 action-ui action-set-w-h action-set-x-y action-set-x-y-vector action-set-opacity">
      <label for="min">Min:</label>
      <input id="min" placeholder="Minimum value" type="number" value="0" />
      <label for="max">Max:</label>
      <input id="max" placeholder="Maximum value" type="number" value="100" />
    </div>
    <div class="inputs col-2 action-ui action-set-scale" style="display: none;">
      <label for="scale-min">Min:</label>
      <input id="scale-min" placeholder="Minimum scale" type="number" value="0.5" />
      <label for="scale-max">Max:</label>
      <input id="scale-max" placeholder="Maximum scale" type="number" value="2" />
    </div>
    <div class="inputs col-2 action-ui action-set-color" style="display: none;">
      <textarea id="color-input" placeholder="Enter one hex code or variable name (ie. categorical/01) per line"></textarea>
    </div>
  </div>
  <div id="applyto">
    <h5>Apply to</h5>
    <div class="inputs col-2 action-ui action-set-w-h">
      <div class="input-checkbox">
        <input type="checkbox" id="width" name="width" value="Width" checked>
        <label for="width">Width</label>
      </div>
      <div class="input-checkbox">
        <input type="checkbox" id="height" name="height" value="Height">
        <label for="height">Height</label>
      </div>
    </div>
    <div class="inputs col-2 action-ui action-set-x-y action-set-x-y-vector" style="display: none;">
      <div class="input-checkbox">
        <input type="checkbox" id="x" name="x" value="X-Axis" checked>
        <label for="x">X-Axis</label>
      </div>
      <div class="input-checkbox">
        <input type="checkbox" id="y" name="y" value="Y-Axis">
        <label for="y">Y-Axis</label>
      </div>
    </div>
    <div class="inputs col-2 action-ui action-set-opacity" style="display: none;">
      <div class="input-checkbox">
        <input type="checkbox" id="opacity" name="opacity" value="Opacity" checked disabled>
        <label for="opacity">Opacity</label>
      </div>
    </div>
    <div class="inputs col-2 action-ui action-set-color" style="display: none;">
      <div class="input-checkbox">
        <input type="checkbox" id="fill" name="fill" value="Fill" checked>
        <label for="fill">Fill</label>
      </div>
      <div class="input-checkbox">
        <input type="checkbox" id="stroke" name="stroke" value="Stroke">
        <label for="stroke">Stroke</label>
      </div>
    </div>
  </div>
  <button id="apply-button">Scale Selection randomly</button>

  <script>
    const actionSelect = document.getElementById('action')
    let action = actionSelect.value
    const csvInput = document.getElementById('csv-input')
    const applyButton = document.getElementById('apply-button')

    const modeChange = () => {
      action = actionSelect.value
      
      document.querySelectorAll('.action-ui').forEach(element => {
        element.style.display = "none"
      })

      document.querySelectorAll('.action-' + action).forEach(element => {
        element.style.display = "flex"
      })

      if (csvInput.value.trim().length > 0) { // If there is input in the CSV textarea
        document.getElementById('input-range').style.display = 'block'

        switch (action) {
          case 'set-w-h':
            applyButton.innerHTML = 'Scale Selection to CSV Values'
            break
          case 'set-x-y':
            applyButton.innerHTML = 'Position Selection to CSV Values'
            break
          case 'set-scale':
              applyButton.innerHTML = 'Scale Selection to CSV Values'
              break
          case 'set-x-y-vector':
            applyButton.innerHTML = 'Setting Points of Vectors to CSV Values'
            break
          case 'set-color':
            applyButton.innerHTML = 'Coloring Selection to CSV Values'
            break
          case 'set-opacity':
            applyButton.innerHTML = 'Setting Opacity of Selection to CSV Values'
            break
        }

      } else { // If the CSV textarea is empty
        document.getElementById('input-range').style.display = 'none'
        applyButton.innerHTML = 'Scale Selection randomly'

        switch (action) {
          case 'set-w-h':
            applyButton.innerHTML = 'Scale Selection randomly'
            break
          case 'set-x-y':
            applyButton.innerHTML = 'Position Selection randomly'
            break
          case 'set-scale':
            applyButton.innerHTML = 'Scale Selection randomly'
            break
          case 'set-x-y-vector':
            applyButton.innerHTML = 'Setting Points of Vectors randomly'
            break
          case 'set-color':
            applyButton.innerHTML = 'Coloring Selection randomly'
            break
          case 'set-opacity':
            applyButton.innerHTML = 'Setting Opacity of Selection randomly'
            break
        }
      }
    }

    actionSelect.addEventListener('change', modeChange)
    csvInput.addEventListener('input', modeChange)

    applyButton.onclick = () => {
      const range = {
        inputMin: document.getElementById('inputMin').value,
        inputMax: document.getElementById('inputMax').value,
        min: document.getElementById('min').value,
        max: document.getElementById('max').value,
        scaleMin: document.getElementById('scale-min').value,
        scaleMax: document.getElementById('scale-max').value,
        colorRange: [],      
      }
      const applyTo = {
        width: document.getElementById('width').checked,
        height: document.getElementById('height').checked,
        x: document.getElementById('x').checked,
        y: document.getElementById('y').checked,
        fill: document.getElementById('fill').checked,
        stroke: document.getElementById('stroke').checked,
        opacity: document.getElementById('opacity').checked
      }

      const raw = document.getElementById('csv-input').value
      let entries = []
      if (raw.length === 0) {
        entries = []
      } else {
        entries = raw
          .split(/\r?\n/) // Split into lines first (preserve empty lines)
          .flatMap(line => {
            if (line.trim() === "") return [null] // Represent empty line
            return line.split(",").map(part => {
              const trimmed = part.trim()
              const num = parseFloat(trimmed)
              return trimmed === "" || isNaN(num) ? null : num
            })
          })
      }

      const rawColors = document.getElementById('color-input').value
      if (rawColors.length === 0) {
        range.colorRange = []
      } else {
        range.colorRange = rawColors
        .split(/\r?\n/)               // Split by line
        .map(line => line.trim())     // Trim whitespace
        .filter(line => line !== ""); // Remove empty lines
      }

      parent.postMessage({ pluginMessage: { type: action /* ie. set-x-y */, values: entries, range, applyTo } }, '*')
    };

  </script>
</body>

</html>